function fisherYates(n){var t=n.length,i,r,u;if(t==0)return!1;while(--t)i=Math.floor(Math.random()*(t+1)),r=n[t],u=n[i],n[t]=u,n[i]=r}var jsonified,hasInitialized;app.controller("QuizModeCtrl",["$scope","$location","$log",function(n,t,i){i.info("initializing QuizModeCtrl"),i.info(n.selectionInfo),n.setEditMode=function(){n.editMode=!0},n.stopEditMode=function(){n.editMode=!1},n.anotherTopic=function(){i.info("Another Topic"),n.sortTopics(),n.selectionInfo.selectedEntrySet=n.jsonified[0],n.quizOnArray(n.selectionInfo.selectedEntrySet)};var r=function(n,t){return n+t};n.next=function(){i.info("Next clicked"),n.selectionInfo.selectedEntryIndex++,n.selectionInfo.selectedEntryIndex>=n.selectionInfo.selectedEntrySet.entries.length&&t.path("/browse")},n.deleteEntry=function(){i.info("About to delete");var t=n.selectionInfo.selectedEntrySet,r=n.selectionInfo.selectedEntry;t.entries.splice(t.entries.indexOf(r),1),n.next()},n.google=function(){i.info("About to Google"),window.open("https://www.google.com/?q="+n.selectionInfo.selectedEntry.text,"_blank")}}]),hasInitialized=!1,app.controller("QuizCtrl",["$scope","$location","$log","angularFire",function(n,t,i,r){i.info("initializing outer QuizModeCtrl");var f=new Firebase("https://jeff-test1.firebaseio.com/learner"),u;hasInitialized||(u=r(f.limit(15),n,"learnerEnvironment",{}),u.then(function(){i.info("Promise completed"),n.jsonified=[],n.learnerEnvironment.topics.forEach(function(t){n.jsonified.push({name:t.name,entries:n.getEntriesForTopic(t)})}),n.initWhenDataReady(),i.info(n.jsonified),i.info("DONE")},function(){i.info("Error")}),hasInitialized=!0),n.selectionInfo||(n.selectionInfo={selectedEntrySet:null,selectedEntry:null,selectedEntryIndex:-1}),n.getEntriesForTopic=function(t){i.info(n.learnerEnvironment.topicDetails),i.info("topic_"+t.name);var r=n.learnerEnvironment.topicDetails["topic_"+t.name].entries;return r?r:[]},n.initWhenDataReady=function(){i.info("Randomizing order of sets"),n.sortTopics=function(){fisherYates(n.jsonified)},n.sortTopics(),n.editMode=!1},n.importLegacy=function(){var t=0;n.learnerEnvironment.topics.splice(0),n.learnerEnvironment.topicDetails={},jsonified.forEach(function(i){var r,u;(t++,t>300)||(i.name&&i.name.length!=0||(i.name="Imported"+t),n.learnerEnvironment.topics||(n.learnerEnvironment.topics=[]),r={name:i.name,entriesLength:i.entries.length},n.learnerEnvironment.topics.push(r),u="topic_"+i.name,n.learnerEnvironment.topicDetails||(n.learnerEnvironment.topicDetails={}),n.learnerEnvironment.topicDetails[u]=i)})},n.openTopic=function(t){n.editMode=!1,n.quizOnArray(t),location.hash="quiz"},n.quizOnArray=function(t){i.info("About to quiz"),n.selectionInfo.selectedEntrySet=t,fisherYates(n.selectionInfo.selectedEntrySet),n.selectionInfo.selectedEntryIndex=0,n.selectionInfo.selectedEntry=n.selectionInfo.selectedEntrySet.entries[n.selectionInfo.selectedEntryIndex]},n.$watch("selectionInfo.selectedEntryIndex",function(t){i.info("selectionInfo.selectedEntryIndex "+t),t&&n.selectionInfo.selectedEntrySet&&(n.selectionInfo.selectedEntry=n.selectionInfo.selectedEntrySet.entries[t])}),n.editSelected=function(t){i.info("Editing"),n.selectionInfo.selectedEntrySet=t,n.editMode=!0},n.recreateJson=function(){var n=jsonified.map(function(n){return{name:n.name,dateReviewed:new Date,entries:n.entries}});i.info(angular.toJson(n))},n.getScope=function(){return{selectedEntry:n.selectionInfo.selectedEntry,setName:n.selectionInfo.selectedEntrySet?n.selectionInfo.selectedEntrySet.name:"",selectedEntrySetLength:n.selectionInfo.selectedEntrySet?n.selectionInfo.selectedEntrySet.entries.length:1,selectedEntryIndex:n.selectionInfo.selectedEntryIndex}},n.initAddMode=function(){n.addMode=!0},n.add=function(){var e,r,o,t,u,f;i.info("Adding content"),e=n.newContent,r=n.newContent.split("\n"),i.info(r),o=r.map(function(n){return{name:n.name,dateReviewed:new Date,entries:n.entries}}),t={name:n.entryName,dateReviewed:new Date,entries:r.map(function(n){return{text:n}})},n.jsonified.push(t),n.learnerEnvironment.topics||(n.learnerEnvironment.topics=[]),u={name:t.name,dateReviewed:new Date,entriesLength:t.entries.length},n.learnerEnvironment.topics.push(u),f="topic_"+t.name,n.learnerEnvironment.topicDetails||(n.learnerEnvironment.topicDetails={}),n.learnerEnvironment.topicDetails[f]=t,n.entryName="",n.newContent="",n.addMode=!1},n.newestFirst=function(){function t(n){return n?new Date(n.toString()):new Date("01/01/2001")}n.jsonified.sort(function(n,i){return t(i.dateReviewed)-t(n.dateReviewed)})}}]);var Topic=function(){function n(){}return n}(),Entry=function(){function n(){}return n}(),SelectionInfo=function(){function n(){}return n}()